<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 게시판 처리 SQL -->
<mapper namespace="com.dostrike.perfectten.DAO.hhMapper">

<insert id="insertOptions" parameterType="Options">

	INSERT INTO OPTIONS(
	
		OPTIONSEQ
		, REQUESTSEQ
		, COMOPTION
		, RANKING
	
	)VALUES(
		
		OPTIONSEQ.NEXTVAL
		,#{requestSeq}
		,#{comOption}
		,#{ranking}
	
	)

</insert>

<insert id="insertRequest" parameterType="Request">

	<selectKey keyProperty="requestSeq" resultType="int" order="BEFORE">

		SELECT REQUESTSEQ.NEXTVAL FROM DUAL

	</selectKey>


	INSERT INTO REQUEST(
    
    	REQUESTSEQ
    	,HHID
    	,COMNAME
    	,COMADDR
		,JOBTITLE
		,EXPLANATION
	
	)VALUES(
	
		#{requestSeq}
		,#{hhId}
		,#{comName}
		,#{comAddr}
		,#{jobTitle}
		,#{explanation}
	
	)

</insert>

<select id="selectOList" parameterType="String" resultType="hashmap">

    select
        req.requestseq as requestseq
		,req.hhid as hhid
        ,req.comname as comname
        ,req.comaddr as comaddr
        ,req.jobtitle as jobtitle
        ,req.explanation as explanation
        ,opt.optionseq as optionseq
        ,opt.comoption as comoption
        ,opt.ranking as ranking

	from
		request req
	left join
		options opt
	on
		req.requestseq = opt.requestseq
	where
		req.hhid=#{hhId}
	order by
		req.requestseq asc
		,opt.ranking asc


</select>

<select id="selectPList" resultType="Person">

	SELECT * FROM PERSON

</select>

<insert id="pickPerson" parameterType="PersonList">

	INSERT INTO PERSONLIST(
	
	 	 LISTSEQ 
	    , HHID 
	    , PERSONID 
	    , REQUESTSEQ
	    , PERSONNAME 
	    , COMNAME 
	    , JOBTITLE 
	    , STATUS 
	    , INDATE 
	    , CONTACTFLAG

	)VALUES(
		
		LISTSEQ.NEXTVAL
		, #{hhId}
		, #{personId}
		, #{requestSeq}
		, #{personName}
		, #{comName}
		, #{jobTitle}
		, 1
		,SYSDATE
		, 0
	
	)

</insert>
 
 <select id="pickList" parameterType="String" resultType="PersonList">
 
 	SELECT
	 	 LISTSEQ 
	    , HHID 
	    , PERSONID 
	    , REQUESTSEQ
	    , PERSONNAME 
	    , COMNAME 
	    , JOBTITLE 
	    , STATUS 
	    , INDATE 
	    , CONTACTFLAG
	    
	FROM
		PERSONLIST 
 
 </select>
 
 <insert id="insertContactMessage" parameterType="ContactMessage">
 
 INSERT INTO CONTACTMESSAGE(
 
    CMSEQ 
    , HHID 
    , HHNAME
    , PERSONID 
    , PERSONNAME 
    , CONTACTTITLE 
    , CONTACTMESSAGE 
    , CMINDATE 
 	, CMSTATUS
 
 )VALUES(
 	
 	CMSEQ.NEXTVAL
 	,#{hhId}
 	,#{hhName}	
 	,#{personId}
 	,#{personName}
 	,#{contactTitle}
 	,#{contactMessage}
 	,SYSDATE
 	,0
 
 )
 
 </insert>
 
 <update id="updateContactFlag" parameterType="hashmap">
 
 UPDATE PERSONLIST
 SET 
 	CONTACTFLAG=1
 WHERE
 	PERSONID=#{contactPerson}
 	AND
 	HHID=#{contactHH}
 
 </update>
 
 
</mapper>
